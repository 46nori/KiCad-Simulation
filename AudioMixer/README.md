# YM2608用オーディオ回路シミュレーション

YAHAMAのFM音源YM2608のオーディオ回路のシミュレーション結果。

## Audio Mixer

以下の構成でFM音源のオーディオ出力をミキシングしてLINE OUTで出力する。
- 加算回路
- LPF
- 減衰アンプ
- バッファ

### 加算回路

加算回路でAC結合の6ch入力信号をミキシングする。


### LPF

ユニティゲインのSallen-Key LPFを構成とする。

$$
\begin{align}
f_c &= \frac{1}{2 \pi R_1 \sqrt{C_1C_2}} \\
R_1 &= R_2 \\
C_1 &= 2 C_2
\end{align}
$$

カットオフ周波数 $f_c$ は可聴帯域である20KHz程度とするため、定数は以下とした。
$R_1=5.1k\Omega, C_1=1000pF, C_2=2200pF \rightarrow f_c \approx 21KHz $ 

### 減衰アンプ

NJM4580を±12V電源で使用しているので、ミキシング後の最大振幅はシミュレーション結果から±10.5V程度。LINE OUTの信号レベル±2V RMSまで減衰させる必要がある。

ゲインを $G$ 、帰還抵抗 $R_f$ とすると、入力抵抗 $R_{total}$ は以下となる。

$$
\begin{align}
G &= - 2 \sqrt{2} \times 2 / (10.5 \times 2) \approx 0.2695 \\
R_{total} &= - R_f / G
\end{align}
$$

$R_f=10K\Omega$ として、$R_{total}=37.106K\Omega$
これを33K, 3.6K, 1Kトリマで構成する。

### バッファ

インピーダンス調整、保護抵抗、カップリングコンデンサでLINE OUT信号を生成。

## ADPCM入力

ADPCMのサンプリングのためのAD入力信号の前処理を行う。

YM2806のアナログ特性を見ると、入力電圧の最大は、
$$
3 \times V_{cc} / 4 = 3 \times 5.0 / 4 = 3.75V
$$

AD入力は、 $V_{cc}/2=2.5V$ オフセットさせるので、2.5±1.25Vに収める必要がある。このためオペアンプでクリップ回路を構成している。

クリップ電圧は帰還抵抗に並列に配置するダイオードの $V_F$ で調整する。本回路では1N4148を2本直列で使用している。

1N4148の仕様では、$V_F=1.0V @160mA$ だが、実際にはこんなに流れない。
シミュレータでは最大205uA程度なので、実際の $V_F$ はもっと低い。
- 1.58 - 3.42V @ $V_F=0.46V$ シミュレーション
- 1.34 - 3.66V @ $V_F=0.58V$ 実測

フルスイング取れていないが実用上は問題ないと思われる。